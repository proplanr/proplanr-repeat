<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymerfire/polymerfire.html">
<link rel="import" href="../polymerfire/firebase-query.html">
<link rel="import" href="../polymerfire/firebase-document.html">
<link rel="import" href="./proplanr-repeat.html">

<dom-module id="proplanr-repeat-firebase">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    

    <firebase-document
      id="repeatData"
      app-name="{{appName}}"
      path="/repeats/key1"
      data="{{repeatData}}">
    </firebase-document>

    <firebase-query log
      id="repeatsData"
      app-name="{{appName}}"
      path="/repeats"
      data="{{repeatsData}}">
    </firebase-query>

    <firebase-query
      id="actionData"
      app-name="{{appName}}"
      path="/actions"
      data="{{actionsData}}">
    </firebase-query>

    <proplanr-repeat></proplanr-repeat>

  </template>    
  <script>
    Polymer({
      is: 'proplanr-repeat-firebase', 

      listeners: {
        'saveRepeat': 'saveData'
      },
    // listen for saveRepeat
    ready: function(event) {
      this.db = this.$.actionData.app.database();
      console.log('proplanr-repeat-firebase',this.db);
    },

    saveData: function(data) {
      // console.log('logActivity:',action,description,listId,this.user);
      // Log activity
        // var db = this.$.firebaseAuth.app.database();
      // var now = new Date().toLocaleString('en-US', {timeZone: 'America/Los_Angeles'});
        // var now = new Date().toLocalString();
      // let newRepeatId = db.ref('/repeats').push(data).key;

      this.db.ref('/repeats').push(data.detail).then(snapshot => {
        let repeat_key = snapshot.key;
        let repeat = data.detail;
        // console.log('data.detail',data.detail);
        // console.log('snapshot',snapshot);
        // console.log('repeat_key',repeat_key);
        // add actions for number occurrencies or end date

          // db.ref('/actions').push({
          //   repeat_key: repeat_key,
          //   title: repeat.title,
          //   due_date: repeat.due_date
          // })

        });
      }

      // then create actions


    });


  </script>
</dom-module>